<!doctype html><html lang="zh-CN" class="night"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=4,user-scalable=0" name="viewport"><title>Edeity&#39;s Blog</title><meta name="description" content="Try to be a qualified programmer"><meta property="og:type" content="website"><meta property="og:description" content="Try to be a qualified programmer"><meta property="og:title" content="Edeity&#39;s Blog"><meta property="og:site_name" content="Edeity&#39;s Blog"><meta property="og:url" content="https://blog.edeity.me"><meta property="og:image" content="https://edeity.oss-cn-shenzhen.aliyuncs.com/public/edeity_o.png"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="mainfest" href="/mainfest.json"><link rel="stylesheet" href="/public/css/common.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_707055_4b9og9sc5lx.css"><script>document.addEventListener("DOMContentLoaded",(function(){let e=-1!==window.location.search.indexOf("theme=night")||"night"===window.localStorage.getItem("edeity-theme_theme"),t=-1!==window.location.search.indexOf("theme=light")||"light"===window.localStorage.getItem("edeity-theme_theme"),o=(new Date).getHours();o=22;var n=document.querySelector("html");(e?n.classList.add("night"):t?n.classList.remove("night"):n.classList.add("night"),null!==document.querySelector("ol.toc"))&&(document.querySelector("#nav-bar").style.cssText="display: block")}))</script><meta name="generator" content="Hexo 5.2.0"></head><body><div class="loading"></div><div id="switch" data-switch="{&#34;toc&#34;:true,&#34;use_pwa&#34;:false}"></div><header class="fullscreen"><div class="toolbar"><i class="iconfont icon-menu"></i></div><h1><a href="/">Edeity&#39;s Blog</a></h1><div class="head-link"><a class="btn waves" href="/"><span><i class="iconfont icon-home">Home </i></span></a><a class="btn waves" href="/about/index.html"><span><i class="iconfont icon-me">About </i></span></a><a class="btn waves" target="_blank" rel="noopener" href="https://github.com/edeity"><span><i class="iconfont icon-github">Github</i></span></a></div></header><div class="some-link"><a class="btn" id="light-or-not"><i class="iconfont icon-light"></i> </a><a style="display:none" class="btn" id="up-to-top"><i class="iconfont icon-up"></i></a></div><div id="nav-bar" style="display:none"><div class="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E5%90%8DHttps%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">域名Https化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%AA%92%E4%BD%93Https%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">多媒体Https化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%EF%BC%9APWA%EF%BC%81"><span class="toc-number">3.</span> <span class="toc-text">其他：PWA！</span></a></li></ol></div></div><main id="content-main" class="section"><div class="list-item"><h1 class="post-title"><a id="Https你的博客" class="article-link" href="">Https你的博客</a></h1><div class="post-meta"><time class="meta published">Jan 25, 2018</time></div><div class="article"><div class="post-excerpt markdown-body"><p>前不久想在自己的博客上尝试<code>PWA</code>（Progressive Web App）功能，而<code>PWA</code>的前置条件是<code>Https</code>。因本域名没有在国内备案，故寻找服务商花费了几天的时间，特将结果记录于此。大致可分为两步：</p><ol><li><code>域名Https</code>（含前端源文件，如HTML、CSS、JS等）</li><li><code>多媒体Https</code>（含前端多媒体资源，如png、jpg、gif等，即图床）</li></ol><h2 id="域名Https化"><a href="#域名Https化" class="headerlink" title="域名Https化"></a>域名Https化</h2><p><a target="_blank" rel="noopener" href="https://www.cloudflare.com/">CloudFlare</a>提供了免费的Https服务，因为联合了百度CDN，即使在国内，也能提供不错的访问速度。</p><p>步骤如下：</p><ol><li><p>在<a target="_blank" rel="noopener" href="https://www.cloudflare.com/">CloudFlare</a>中<code>Add New Website</code>，按照提示填写自己的域名，eg：<code>edeity.me</code></p></li><li><p>更改域名记录，将记录类型更改为<code>NS</code>类型，并指向CloudFlareDNS服务解析器，<code>anirban.ns.cloudflare.com</code>、<code>gail.ns.cloudflare.com</code>，配置如下：</p><p><img src="https://edeity.oss-cn-shenzhen.aliyuncs.com/domain_config.png" alt="阿里云DNS配置"></p></li><li><p>CloudFlare添加成功后，等待片刻，即可通过Https访问网站。</p><ul><li>推荐总是启用Https，步骤：<code>域名面板</code>-&gt;<code>SSL</code>-&gt;<code>Always use HTTPS</code>-&gt;<code>ON</code>，后续访问Http时，也会跳转到Https上。</li></ul></li></ol><h2 id="多媒体Https化"><a href="#多媒体Https化" class="headerlink" title="多媒体Https化"></a>多媒体Https化</h2><p>因七牛存储不再提供https二级域名，而自定义域名又需要繁琐的备案，只好放弃。</p><p>考虑博客流量不大，大方地使用了<a target="_blank" rel="noopener" href="https://oss.console.aliyun.com/">OSS</a>（阿里云旗下的服务，收费）。</p><p>不注重访问速度，或国外的用户可考虑Yahoo的<a target="_blank" rel="noopener" href="https://www.flickr.com/">flickr</a>，有1T的<strong>免费</strong>存储空间。</p><p>注：默认配置中，OSS的资源是是私有的（无法外网访问），需要在<code>基础设置</code>中，把<code>读写权限</code>更改为<code>公共读</code>。</p><h2 id="其他：PWA！"><a href="#其他：PWA！" class="headerlink" title="其他：PWA！"></a>其他：PWA！</h2><p>假如没有定制化需求，建议使用Workbox3，参考：<a href="/learn_workbox.html">Workbox3初探：让离线缓存变得简单</a></p><hr><p><strong>以下为原纪录（不推荐）：</strong></p><p>网站升级为Https后，尝试<code>PWA</code>的功能，在此仅列举一项功能：<code>离线缓存</code>。</p><p>参考google给出的<a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/codelabs/your-first-pwapp/">范文</a>。</p><ol><li><p>引入<code>Manifest.json</code>，用于描述你的PWA：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;manifest&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/manifest.json&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>告知<code>PWA</code>配置文件名称，并启动：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (navigator.serviceWorker != <span class="literal">null</span>) &#123;</span><br><span class="line">	navigator.serviceWorker.register(<span class="string">&#x27;/service-worker.js&#x27;</span>)</span><br><span class="line">		.then(<span class="function"><span class="keyword">function</span>(<span class="params">registration</span>) </span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">&#x27;PWA regist success&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在配置文件<code>service-worker.js</code>运行离线脚本</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> filesToCace = [<span class="string">&#x27;在此书写需要缓存的资源，如/index.html&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 激活缓存</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;activate&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.waitUntil(</span><br><span class="line">        caches.keys().then(<span class="function"><span class="keyword">function</span>(<span class="params">keyList</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.all(keyList.map(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (key !== cacheName) &#123;</span><br><span class="line">            	<span class="keyword">return</span> caches.delete(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> self.clients.claim();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拦截，判断是否可从缓存中读取资源</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;fetch&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.respondWith(</span><br><span class="line">        caches.match(e.request).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response || fetch(e.request);</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>由于Hexo的Url路径均是动态生成的，将所有的url都写入<code>Service-worker.js</code>的<code>filesToCace</code>中是件苦力活，可采用<a target="_blank" rel="noopener" href="https://github.com/JLHwung/hexo-offline">hexo-offline</a>可以自动完成这份工作。</p><ul><li><code>yarn install hexo-offline --dev</code></li></ul></li></ol><ul><li><p>由于不知名的缘故，采用<code>hexo-offline</code>后，文件的权限变更了。回顾<code>chown</code>的用法：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 755 for 文件夹、可执行文件</span></span><br><span class="line"><span class="comment"># 644 fro 普通文件</span></span><br><span class="line"><span class="comment"># 400 for 证书</span></span><br><span class="line">chmod 755 -R dir </span><br><span class="line"><span class="comment"># 更改目录所有者</span></span><br><span class="line">chown -R user</span><br></pre></td></tr></table></figure></li></ul></div></div></div><div class="more section"><div class="pre"><a class="article-link" href="/code_react_redux.html"><i class="iconfont icon-right"></i> <span>react-redux实现原理</span></a></div><div class="next"><a class="article-link" href="/my_enterprise_application.html">我所认知的企业级ERP应用 <i class="iconfont icon-right"></i></a></div></div></main></body><footer class="section fullscreen"><div class="footer-desc">Edeity © 2015-2019 · powered by hexo</div></footer><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script src="/public/js/init.js"></script></html>