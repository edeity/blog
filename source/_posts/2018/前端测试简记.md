---
title: 前端测试简记：mocha + chai
link: test_for_front_end
date: 2018-01-05
categories: study
tags: [test case, mochai, node dev]
---



个人折腾玩具代码时，有一些数据层接口（类Kero接口）需要保证稳定性；故打算写单元测试。

`create-react-app`工具自带[jest](http://facebook.github.io/jest/)，但稍打听，发现还是`mocha+chai`用的比较多，故学习一下；在create-react-app上使用mocha则非常简单：

## 在CRA中使用mocha

因为工程是CRA生成的，按照[文章](https://www.codementor.io/daveschinkel13/running-mocha-enzyme-with-creat-react-app-84flnngkk#getting-mocha-to-work-again-steps)步骤：

1. 安装`babel-preset-react-app`

   ```bash
   yarn add -D babel-preset-react-app
   ```

2. 在项目根目录新建`.babelrc`配置文件，并输入内容

   ```json
   "babel": {
       "presets": [
         "react-app"
       ],
       "plugins": [
         "transform-es2015-modules-commonjs"
       ]
     }
   ```

   `plugins`中的配置是为了转移ES6（如import或staic）这样的属性；假若使用的是ES5，则可以不选；

3. 在`package.json ` 的 `scripts`一项中，输入（或覆盖）脚本

   ```bash
   NODE_ENV=development mocha --require babel-core/register ./src/Hera/test/*.test.js
   ```

   其中 `require`选项为使用babel编译ES6语法，而`./src/Hera/test/*.test.js`为使用通配符匹配测试文件，假若不输入，则默认为`/test`文件夹；

4. 运行测试程序即可，有关mocha和chai的入门可参考阮一峰的[文章](http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html)

   ```bash
   yarn test
   ```

   ![测试结果](https://edeity.oss-cn-shenzhen.aliyuncs.com/yarn-test.png)

## 在Chrome中调试Node

基于上一小节，可以运行mocha，但不知如何断点调试；有文章建议用`node-inspector`，深入之，发现chrome已经拓展了该工具；可参考[文章](https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27)，步骤也很简单：

1. 在Chrome中输入

   ```http
   chrome://inspect/#devices
   ```

   点击`open dedicated DevTools for Node`允许Node连接

2. 将package.json中原`test`脚本，添加`--inspect-brk `选项

   ```bash
   # 原来
   NODE_ENV=development mocha --require babel-core/register ./src/Hera/test/*.test.js
   # 更改后
   NODE_ENV=development mocha --inspect-brk --require babel-core/register ./src/Hera/test/*.test.js
   ```

3. 在测试的脚本中标注`debugger`，运行`yarn test`

   ![chrome-test](https://edeity.oss-cn-shenzhen.aliyuncs.com/chrome-test.png)

## 关于测试

平常工作中，调试多，测试少；

语法方面，编辑器 + eslint即可满足大部分的静态代码检测；

数据方面，尤其是前端被调用的数据层接口，写单元测试还是蛮重要的；

视图方面，前一阵子看测试部在用[Selenium](http://docs.seleniumhq.org/) ，感觉中规中矩；然而视图或业务变动太频繁，个人认为初期不用太过关注该部分。大不了一声吼：这个世界就没有没有Bug的程序！